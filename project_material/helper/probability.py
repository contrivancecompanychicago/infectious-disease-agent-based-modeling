import random

# Helper constants
cumulative_age_dist_alberta = [
        ('<0', -99, 0, 0.00000000),
        ('0-4', 0, 4, 0.0655285260476598),
        ('5-9', 5, 9, 0.132089713706862),
        ('10-14', 10, 14, 0.191571022531693),
        ('15-19', 15, 19, 0.250588862990391),
        ('20-24', 20, 24, 0.314965479597557),
        ('25-29', 25, 29, 0.391416860905398),
        ('30-34', 30, 34, 0.473335201959107),
        ('35-39', 35, 39, 0.54845026996725),
        ('40-44', 40, 44, 0.617590652937185),
        ('45-49', 45, 49, 0.683737546592708),
        ('50-54', 50, 54, 0.753641361539748),
        ('55-59', 55, 59, 0.821388880693162),
        ('60-64', 60, 64, 0.877012460783446),
        ('65-69', 65, 69, 0.919715477138839),
        ('70-74', 70, 74, 0.948491084688087),
        ('75-79', 75, 79, 0.969133252687379),
        ('80-84', 80, 84, 0.984417873897265),
        ('85-89', 85, 89, 0.994244140874713),
        ('90-94', 90, 94, 0.998675980290915),
        ('95-99', 95, 99, 0.999840183322023),
        ('100/above', 100, 115, 1.00000),
    ]

hypertension_prevalence_female_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.0),
    ('5-9', 5, 9, 0.0),
    ('10-14', 10, 14, 0.004),
    ('15-19', 15, 19, 0.004),
    ('20-24', 20, 24, 0.005),
    ('25-29', 25, 29, 0.016),
    ('30-34', 30, 34, 0.032),
    ('35-39', 35, 39, 0.052),
    ('40-44', 40, 44, 0.087),
    ('45-49', 45, 49, 0.142),
    ('50-54', 50, 54, 0.226),
    ('55-59', 55, 59, 0.328),
    ('60-64', 60, 64, 0.436),
    ('65-69', 65, 69, 0.548),
    ('70-74', 70, 74, 0.645),
    ('75-79', 75, 79, 0.718),
    ('80-84', 80, 84, 0.77),
    ('85-89', 85, 89, 0.775),
    ('90-94', 90, 94, 0.775),
    ('95-99', 95, 99, 0.775),
    ('100/above', 100, 115, 0.775),
    ]

hypertension_prevalence_male_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.0),
    ('5-9', 5, 9, 0.0),
    ('10-14', 10, 14, 0.004),
    ('15-19', 15, 19, 0.004),
    ('20-24', 20, 24, 0.006),
    ('25-29', 25, 29, 0.017),
    ('30-34', 30, 34, 0.036),
    ('35-39', 35, 39, 0.062),
    ('40-44', 40, 44, 0.099),
    ('45-49', 45, 49, 0.154),
    ('50-54', 50, 54, 0.231),
    ('55-59', 55, 59, 0.329),
    ('60-64', 60, 64, 0.43),
    ('65-69', 65, 69, 0.523),
    ('70-74', 70, 74, 0.604),
    ('75-79', 75, 79, 0.667),
    ('80-84', 80, 84, 0.703),
    ('85-89', 85, 89, 0.683),
    ('90-94', 90, 94, 0.683),
    ('95-99', 95, 99, 0.683),
    ('100/above', 100, 115, 0.683),
    ]

diabetes_prevalence_female_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.001),
    ('5-9', 5, 9, 0.002),
    ('10-14', 10, 14, 0.004),
    ('15-19', 15, 19, 0.006),
    ('20-24', 20, 24, 0.007),
    ('25-29', 25, 29, 0.011),
    ('30-34', 30, 34, 0.018),
    ('35-39', 35, 39, 0.029),
    ('40-44', 40, 44, 0.043),
    ('45-49', 45, 49, 0.059),
    ('50-54', 50, 54, 0.079),
    ('55-59', 55, 59, 0.111),
    ('60-64', 60, 64, 0.151),
    ('65-69', 65, 69, 0.191),
    ('70-74', 70, 74, 0.226),
    ('75-79', 75, 79, 0.259),
    ('80-84', 80, 84, 0.27),
    ('85-89', 85, 89, 0.241),
    ('90-94', 90, 94, 0.241),
    ('95-99', 95, 99, 0.241),
    ('100/above', 100, 115, 0.241),
    ]

diabetes_prevalence_male_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.001),
    ('5-9', 5, 9, 0.002),
    ('10-14', 10, 14, 0.004),
    ('15-19', 15, 19, 0.006),
    ('20-24', 20, 24, 0.007),
    ('25-29', 25, 29, 0.009),
    ('30-34', 30, 34, 0.015),
    ('35-39', 35, 39, 0.026),
    ('40-44', 40, 44, 0.046),
    ('45-49', 45, 49, 0.072),
    ('50-54', 50, 54, 0.102),
    ('55-59', 55, 59, 0.144),
    ('60-64', 60, 64, 0.198),
    ('65-69', 65, 69, 0.254),
    ('70-74', 70, 74, 0.298),
    ('75-79', 75, 79, 0.328),
    ('80-84', 80, 84, 0.332),
    ('85-89', 85, 89, 0.287),
    ('90-94', 90, 94, 0.287),
    ('95-99', 95, 99, 0.287),
    ('100/above', 100, 115, 0.287),
    ]

ischemic_heart_disease_prevalence_female_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.0),
    ('5-9', 5, 9, 0.0),
    ('10-14', 10, 14, 0.0),
    ('15-19', 15, 19, 0.0),
    ('20-24', 20, 24, 0.001),
    ('25-29', 25, 29, 0.002),
    ('30-34', 30, 34, 0.004),
    ('35-39', 35, 39, 0.007),
    ('40-44', 40, 44, 0.012),
    ('45-49', 45, 49, 0.02),
    ('50-54', 50, 54, 0.035),
    ('55-59', 55, 59, 0.058),
    ('60-64', 60, 64, 0.091),
    ('65-69', 65, 69, 0.137),
    ('70-74', 70, 74, 0.193),
    ('75-79', 75, 79, 0.254),
    ('80-84', 80, 84, 0.318),
    ('85-89', 85, 89, 0.385),
    ('90-94', 90, 94, 0.385),
    ('95-99', 95, 99, 0.385),
    ('100/above', 100, 115, 0.385),
    ]

ischemic_heart_disease_prevalence_male_canada = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.0),
    ('5-9', 5, 9, 0.0),
    ('10-14', 10, 14, 0.0),
    ('15-19', 15, 19, 0.0),
    ('20-24', 20, 24, 0.001),
    ('25-29', 25, 29, 0.002),
    ('30-34', 30, 34, 0.005),
    ('35-39', 35, 39, 0.009),
    ('40-44', 40, 44, 0.019),
    ('45-49', 45, 49, 0.037),
    ('50-54', 50, 54, 0.066),
    ('55-59', 55, 59, 0.109),
    ('60-64', 60, 64, 0.168),
    ('65-69', 65, 69, 0.238),
    ('70-74', 70, 74, 0.311),
    ('75-79', 75, 79, 0.382),
    ('80-84', 80, 84, 0.446),
    ('85-89', 85, 89, 0.479),
    ('90-94', 90, 94, 0.479),
    ('95-99', 95, 99, 0.479),
    ('100/above', 100, 115, 0.479),
    ]

asthma_prevalence_female_alberta = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.134),
    ('5-9', 5, 9, 0.134),
    ('10-14', 10, 14, 0.146),
    ('15-19', 15, 19, 0.146),
    ('20-24', 20, 24, 0.107),
    ('25-29', 25, 29, 0.107),
    ('30-34', 30, 34, 0.107),
    ('35-39', 35, 39, 0.104),
    ('40-44', 40, 44, 0.104),
    ('45-49', 45, 49, 0.104),
    ('50-54', 50, 54, 0.084),
    ('55-59', 55, 59, 0.084),
    ('60-64', 60, 64, 0.084),
    ('65-69', 65, 69, 0.104),
    ('70-74', 70, 74, 0.104),
    ('75-79', 75, 79, 0.104),
    ('80-84', 80, 84, 0.104),
    ('85-89', 85, 89, 0.104),
    ('90-94', 90, 94, 0.104),
    ('95-99', 95, 99, 0.104),
    ('100/above', 100, 115, 0.104),
    ]

asthma_prevalence_male_alberta = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.134),
    ('5-9', 5, 9, 0.134),
    ('10-14', 10, 14, 0.195),
    ('15-19', 15, 19, 0.195),
    ('20-24', 20, 24, 0.137),
    ('25-29', 25, 29, 0.137),
    ('30-34', 30, 34, 0.137),
    ('35-39', 35, 39, 0.089),
    ('40-44', 40, 44, 0.089),
    ('45-49', 45, 49, 0.089),
    ('50-54', 50, 54, 0.071),
    ('55-59', 55, 59, 0.071),
    ('60-64', 60, 64, 0.071),
    ('65-69', 65, 69, 0.057),
    ('70-74', 70, 74, 0.057),
    ('75-79', 75, 79, 0.057),
    ('80-84', 80, 84, 0.057),
    ('85-89', 85, 89, 0.057),
    ('90-94', 90, 94, 0.057),
    ('95-99', 95, 99, 0.057),
    ('100/above', 100, 115, 0.057),
    ]

cancer_prevalence_female_alberta = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.000903),
    ('5-9', 5, 9, 0.000903),
    ('10-14', 10, 14, 0.000903),
    ('15-19', 15, 19, 0.000903),
    ('20-24', 20, 24, 0.002261),
    ('25-29', 25, 29, 0.002261),
    ('30-34', 30, 34, 0.00653),
    ('35-39', 35, 39, 0.00653),
    ('40-44', 40, 44, 0.017064),
    ('45-49', 45, 49, 0.017064),
    ('50-54', 50, 54, 0.036407),
    ('55-59', 55, 59, 0.036407),
    ('60-64', 60, 64, 0.062311),
    ('65-69', 65, 69, 0.062311),
    ('70-74', 70, 74, 0.091231),
    ('75-79', 75, 79, 0.091231),
    ('80-84', 80, 84, 0.095325),
    ('85-89', 85, 89, 0.095325),
    ('90-94', 90, 94, 0.078488),
    ('95-99', 95, 99, 0.078488),
    ('100/above', 100, 115, 0.078488),
    ]

cancer_prevalence_male_alberta = [
    ('<0', -99, 0, 0.0),
    ('0-4', 0, 4, 0.000983),
    ('5-9', 5, 9, 0.000983),
    ('10-14', 10, 14, 0.000983),
    ('15-19', 15, 19, 0.000983),
    ('20-24', 20, 24, 0.001998),
    ('25-29', 25, 29, 0.001998),
    ('30-34', 30, 34, 0.004239),
    ('35-39', 35, 39, 0.004239),
    ('40-44', 40, 44, 0.008225),
    ('45-49', 45, 49, 0.008225),
    ('50-54', 50, 54, 0.025922),
    ('55-59', 55, 59, 0.025922),
    ('60-64', 60, 64, 0.07594),
    ('65-69', 65, 69, 0.07594),
    ('70-74', 70, 74, 0.141662),
    ('75-79', 75, 79, 0.141662),
    ('80-84', 80, 84, 0.159515),
    ('85-89', 85, 89, 0.159515),
    ('90-94', 90, 94, 0.128559),
    ('95-99', 95, 99, 0.128559),
    ('100/above', 100, 115, 0.128559),
    ]

# Core functions
def age_generator():
    '''Based on AB 2016 census https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/page.cfm?Lang=E&Geo1=PR&Code1=48&Geo2=PR&Code2=01&Data=Count&SearchText=canada&SearchType=Begins&SearchPR=01&B1=All'''
    cumulative_age_dist = cumulative_age_dist_alberta
    random_num = random.uniform(0, 1)
    result_age = None

    for i in range(0, len(cumulative_age_dist)-1, 1):
        if (random_num >= cumulative_age_dist[i][3]) & (random_num < cumulative_age_dist[i+1][3]):
            result_age = random.randint(cumulative_age_dist[i+1][1], cumulative_age_dist[i+1][2])
    return result_age

def comorbidity_generator(comorbidity_type, age, sex):
    if comorbidity_type == 'hypertension':
        prevalence_female = hypertension_prevalence_female_canada
        prevalence_male = hypertension_prevalence_male_canada
    elif comorbidity_type == 'diabetes':
        prevalence_female = diabetes_prevalence_female_canada
        prevalence_male = diabetes_prevalence_male_canada
    elif comorbidity_type == 'ischemic heart disease':
        prevalence_female = ischemic_heart_disease_prevalence_female_canada
        prevalence_male = ischemic_heart_disease_prevalence_male_canada
    elif comorbidity_type == 'asthma':
        prevalence_female = asthma_prevalence_female_alberta
        prevalence_male = asthma_prevalence_male_alberta
    elif comorbidity_type == 'cancer':
        prevalence_female = cancer_prevalence_female_alberta
        prevalence_male = cancer_prevalence_male_alberta
    else:
        raise ValueError('Wrong input for `comorbidity_type` parameter.')

    if sex is 'M':
        prevalence = prevalence_male
    else:
        prevalence = prevalence_female

    random_num = random.uniform(0, 1)
    for i in prevalence:
        if (age >= i[1]) & (age < i[2]+1):
            if random_num < i[3]:
                return 'Y'
            else:
                return 'N'

def probability_rescaler(*args):
    '''Rescale probabilities to sum to 1.0'''
    factor = 10000000
    sum = 0
    result = tuple()
    for prob in args:
        sum += prob * factor
    for prob in args:
        result = result + ((prob * factor)/sum,)
    return result